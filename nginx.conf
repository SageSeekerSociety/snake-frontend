server {
    # 监听 80 端口
    listen 80;

    # 设置网站的根目录，指向我们从构建阶段复制过来的文件
    root /usr/share/nginx/html;

    # 启用 gzip 压缩
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json
        application/xml
        image/svg+xml;

    # 默认首页文件
    index index.html;

    # 核心配置：处理所有请求
    location / {
        # try_files 会按顺序尝试查找文件:
        # 1. $uri: 查找与请求 URI 完全匹配的文件 (例如 /assets/logo.png)
        # 2. $uri/: 查找与请求 URI 匹配的目录 (例如 /admin/)
        # 3. /index.html: 如果上面都找不到，就返回根目录下的 index.html 文件
        #
        # 这一行是实现前端路由（History模式）的关键。
        # 它确保了所有未匹配到静态资源的请求都由 Vue 应用来接管处理。
        try_files $uri $uri/ /index.html;
    }

    # 启用静态预压缩文件支持
    gzip_static on;
    
    # 静态资源缓存策略
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # HTML文件不缓存，确保能获取到最新版本
    location ~* \.html$ {
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
    }
}